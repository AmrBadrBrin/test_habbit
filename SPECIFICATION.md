# Спецификация: Трекер привычек для Telegram Mini App

## 1. Описание проекта

Telegram Mini App для отслеживания ежедневных привычек с визуализацией прогресса, напоминаниями и мотивацией пользователей.

## 2. Целевая аудитория

Пользователи Telegram, желающие формировать и отслеживать полезные привычки.

## 3. Навигация приложения

### 3.0 Bottom Tab Navigation (Навигационная панель внизу экрана)
Всегда видимая навигационная панель с тремя вкладками:

1. **Главная** (иконка: дом)
   - Основной экран с трекером привычек
   - Быстрое отслеживание выполнения за сегодня

2. **Привычки** (иконка: список/галочка)
   - Полный список всех созданных привычек
   - Управление привычками (удаление, редактирование)

3. **Профиль** (иконка: пользователь)
   - Информация о пользователе
   - Настройки приложения (детали позже)

## 4. Основные функции

### 4.1 Главная (Home) - Вкладка 1
- **Список активных привычек** с индикаторами выполнения за сегодня
- **Быстрое выполнение** - tap/swipe для отметки привычки как выполненной
- **Напоминания** - блок с невыполненными сегодня привычками
- **Мотивационный блок** - поддержка и streak (серия выполнений)
- **Кнопка добавления** новой привычки (FAB - Floating Action Button)

### 4.2 Привычки (Habits) - Вкладка 2
- **Список всех привычек** пользователя
- **Карточки привычек** с иконкой, названием и streak
- **Кнопка удаления** для каждой привычки
- **Кнопка редактирования** для каждой привычки
- При клике на привычку - переход к детальной статистике

### 4.3 Профиль (Profile) - Вкладка 3
- Информация о пользователе Telegram
- Общая статистика (детали будут разработаны позже)
- Настройки приложения (детали будут разработаны позже)

### 4.4 Управление привычками

#### Добавление привычки:
- Название привычки (обязательно)
- Описание (опционально)
- Иконка/эмодзи (выбор из набора)
- Время напоминания (опционально)
- Цель (количество дней подряд)

#### Редактирование привычки:
- Все поля доступны для изменения
- Возможность удаления

### 4.5 Экран статистики привычки

- **Визуализация прогресса** - столбчатая диаграмма по дням недели
- **Текущий streak** - количество дней подряд выполнения
- **Общая статистика**:
  - Всего выполнений
  - Процент выполнения
  - Лучший streak
  - Текущая неделя vs предыдущая
- **Календарь** - месячный вид с отметками выполнения

## 5. Дизайн

### 5.1 Принципы дизайна
- **Минимализм** - чистый интерфейс без лишних элементов
- **Мобильный first** - оптимизация под экраны смартфонов
- **Понятность** - интуитивная навигация и действия
- **Telegram Design System** - соответствие UI/UX Telegram

### 5.2 Цветовая схема
- Поддержка светлой и темной темы Telegram
- Акцентный цвет для выполненных привычек (зеленый)
- Нейтральные цвета для невыполненных
- Яркие цвета для мотивационных элементов

### 5.3 Типографика
- Использование системных шрифтов SF Pro (iOS) / Roboto (Android)
- Иерархия заголовков и текста
- Хорошая читаемость на малых экранах

### 5.4 Компоненты
- **Bottom Tab Navigation** - навигационная панель внизу экрана (всегда видима)
- **Карточки привычек** - с иконкой, названием, streak
- **Чекбокс/Toggle** - для отметки выполнения
- **Progress Bar** - визуализация прогресса
- **Графики** - столбчатые диаграммы для статистики
- **Модальные окна** - для добавления/редактирования
- **Bottom Sheet** - для дополнительных действий

## 6. Технический стек

### 6.1 Frontend
- **Framework**: React 18+ с TypeScript
- **Routing**: React Router DOM (для навигации между вкладками)
- **Styling**: Tailwind CSS / CSS Modules
- **State Management**: Zustand / Context API
- **Telegram Mini App SDK**: @twa-dev/sdk
- **Графики**: Recharts / Chart.js
- **UI компоненты**: Radix UI / Headless UI
- **Анимации**: Framer Motion (опционально)

### 6.2 Backend
- **Runtime**: Node.js 20+
- **Framework**: Express.js / Fastify
- **База данных**: PostgreSQL / SQLite
- **ORM**: Prisma
- **Валидация**: Zod
- **Аутентификация**: Telegram Mini App initData

### 6.3 Деплой
- **Frontend**: Vercel / Netlify / GitHub Pages
- **Backend**: Railway / Render / Fly.io
- **База данных**: Neon / Supabase / PlanetScale

## 7. Структура базы данных

**КРИТИЧЕСКИ ВАЖНО**: Все запросы к данным привычек ДОЛЖНЫ фильтроваться по `user_id`. Каждый пользователь видит только свои привычки!

### 7.1 Таблица Users
```sql
- id (UUID, PK)
- telegram_id (BIGINT, Unique, Not Null) -- Уникальный ID из Telegram
- username (VARCHAR)
- first_name (VARCHAR)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
```

### 7.2 Таблица Habits
```sql
- id (UUID, PK)
- user_id (UUID, FK -> Users, Not Null) -- ОБЯЗАТЕЛЬНАЯ связь с пользователем
- title (VARCHAR, Not Null)
- description (TEXT)
- icon (VARCHAR)
- reminder_time (TIME)
- target_days (INTEGER)
- is_archived (BOOLEAN, Default: false)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

INDEX: (user_id) -- Для быстрой выборки привычек пользователя
```

### 7.3 Таблица Completions
```sql
- id (UUID, PK)
- habit_id (UUID, FK -> Habits, Not Null)
- completed_at (DATE, Not Null)
- created_at (TIMESTAMP)
- UNIQUE(habit_id, completed_at)

INDEX: (habit_id, completed_at) -- Для быстрой выборки выполнений
```

### 7.4 Правила безопасности данных

**ОБЯЗАТЕЛЬНЫЕ проверки на бэкенде:**

1. При аутентификации:
   - Проверять `initData` от Telegram
   - Извлекать `telegram_id` из валидированных данных
   - Создавать/находить пользователя по `telegram_id`

2. При работе с привычками:
   - ВСЕГДА проверять, что `habit.user_id === authenticated_user_id`
   - НИКОГДА не возвращать привычки других пользователей
   - При создании привычки - автоматически привязывать к текущему пользователю

3. При работе с выполнениями:
   - Проверять принадлежность привычки текущему пользователю
   - Запрещать отметки чужих привычек

**Пример защиты на уровне API:**
```typescript
// BAD - НЕПРАВИЛЬНО
const habits = await db.habits.findMany()

// GOOD - ПРАВИЛЬНО
const habits = await db.habits.findMany({
  where: { user_id: authenticatedUserId }
})
```

## 8. API Эндпоинты

**ВАЖНО**: Все эндпоинты (кроме аутентификации) требуют валидного Telegram initData в заголовках.

### 8.1 Аутентификация
- `POST /api/auth/verify` - Проверка Telegram initData и создание/получение пользователя

### 8.2 Привычки
**Все эндпоинты автоматически фильтруют данные по текущему пользователю!**

- `GET /api/habits` - Получить все привычки текущего пользователя
- `POST /api/habits` - Создать новую привычку (автоматически привязывается к пользователю)
- `GET /api/habits/:id` - Получить привычку по ID (только свою)
- `PUT /api/habits/:id` - Обновить привычку (только свою)
- `DELETE /api/habits/:id` - Удалить привычку (только свою)

### 8.3 Выполнения
- `POST /api/habits/:id/complete` - Отметить привычку выполненной (только свою)
- `DELETE /api/habits/:id/complete/:date` - Отменить выполнение (только своё)
- `GET /api/habits/:id/completions` - Получить историю выполнений (только своей привычки)
- `GET /api/habits/:id/stats` - Получить статистику по привычке (только своей)

### 8.4 Статистика
- `GET /api/stats/overview` - Общая статистика текущего пользователя

## 9. Этапы разработки

### Этап 1: Подготовка (MVP базовая структура)
- [x] Создание спецификации
- [ ] Инициализация проекта
- [ ] Настройка TypeScript, ESLint, Prettier
- [ ] Настройка Tailwind CSS
- [ ] Интеграция Telegram Mini App SDK

### Этап 2: Backend (MVP)
- [ ] Настройка Express + Prisma
- [ ] Создание схемы базы данных
- [ ] Реализация аутентификации через Telegram
- [ ] CRUD API для привычек
- [ ] API для отметок выполнения

### Этап 3: Frontend (MVP)
- [ ] Bottom Tab Navigation (навигация между вкладками)
- [ ] Вкладка "Главная" - список привычек с быстрым выполнением
- [ ] Вкладка "Привычки" - список всех привычек с управлением
- [ ] Вкладка "Профиль" - базовая информация о пользователе
- [ ] Форма добавления привычки
- [ ] Возможность отметить привычку выполненной
- [ ] Базовая визуализация streak

### Этап 4: Статистика
- [ ] Экран детальной статистики привычки
- [ ] Столбчатая диаграмма по дням недели
- [ ] Календарный вид
- [ ] Расчет streak и процента выполнения

### Этап 5: UX улучшения
- [ ] Напоминания на главном экране
- [ ] Мотивационные сообщения
- [ ] Swipe-действия для управления
- [ ] Анимации и переходы

### Этап 6: Полировка
- [ ] Адаптивный дизайн
- [ ] Темная/светлая тема
- [ ] Оптимизация производительности
- [ ] Тестирование

### Этап 7: Деплой
- [ ] Деплой frontend
- [ ] Деплой backend
- [ ] Настройка Telegram Bot и Mini App
- [ ] Финальное тестирование

## 10. MVP Features (Минимально жизнеспособный продукт)

Для первой версии включить:
1. **Bottom Tab Navigation** - навигация между 3 вкладками
2. **Вкладка "Главная"** - список привычек с быстрым выполнением
3. **Вкладка "Привычки"** - управление привычками (удаление, редактирование)
4. **Вкладка "Профиль"** - базовая информация
5. Добавление привычек (название, иконка)
6. Отметка выполнения (чекбокс)
7. Базовый счетчик streak
8. Простая статистика (столбцы за неделю)

Отложить на следующие версии:
- Напоминания (notifications)
- Архивация
- Фильтры и сортировка
- Экспорт данных
- Социальные функции
- Цели и награды

## 11. Безопасность

**Критически важно для разделения пользователей:**
- Валидация Telegram initData для аутентификации
- Извлечение `telegram_id` из валидированных данных
- ОБЯЗАТЕЛЬНАЯ фильтрация всех данных по `user_id`
- Проверка принадлежности привычек текущему пользователю
- Sanitization пользовательского ввода
- Rate limiting на API
- HTTPS only
- CORS настройки
- Environment variables для секретов

## 12. Производительность

- Кэширование данных на клиенте
- Lazy loading компонентов и вкладок
- Оптимизация запросов к БД (индексы на user_id)
- Compression для API responses
- CDN для статических ресурсов
- Оптимизация навигации (предзагрузка вкладок)

## 13. Дальнейшее развитие

### Возможные фичи v2.0+:
- Push-уведомления через Telegram Bot
- Детальная страница профиля с настройками
- Фильтры и сортировка на вкладке "Привычки"
- Шаринг достижений
- Групповые челленджи
- Категории привычек
- Экспорт/импорт данных
- Интеграция с календарем
- Gamification (бейджи, уровни)
- AI рекомендации привычек
- Streak recovery (пропуск 1 дня)
- Заметки к выполнениям
